<?xml version="1.0" encoding="UTF-8"?>
<Export generator="IRIS" version="26" zv="IRIS for UNIX (Ubuntu Server 22.04 LTS for x86-64) 2025.1.1 (Build 313_1U)" ts="2025-11-06 01:59:07">
<Class name="MeetUp2025.BayInfo">
<Description>
</Description>
<Final>1</Final>
<ClassType>persistent</ClassType>
<DdlAllowed>1</DdlAllowed>
<Owner>SuperUser</Owner>
<ProcedureBlock>1</ProcedureBlock>
<SqlRowIdPrivate>1</SqlRowIdPrivate>
<SqlTableName>BayInfo</SqlTableName>
<Super>%Persistent</Super>
<TimeChanged>67499,85313.626411114</TimeChanged>
<TimeCreated>67499,85272.947753113</TimeCreated>

<Property name="SpotID">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>2</SqlColumnNumber>
<Parameter name="MAXLEN" value="10"/>
</Property>

<Property name="SpotName">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>3</SqlColumnNumber>
<Parameter name="MAXLEN" value="60"/>
</Property>

<Property name="DatetimeJst">
<Type>%Library.PosixTime</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>4</SqlColumnNumber>
</Property>

<Property name="TideHeightCmRelative">
<Type>%Library.Numeric</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>5</SqlColumnNumber>
<Parameter name="MAXVAL" value="999.9"/>
<Parameter name="MINVAL" value="-999.9"/>
<Parameter name="SCALE" value="1"/>
</Property>

<Property name="TideState">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>6</SqlColumnNumber>
<Parameter name="MAXLEN" value="50"/>
</Property>

<Property name="TideCycle">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>7</SqlColumnNumber>
<Parameter name="MAXLEN" value="50"/>
</Property>

<Index name="DDLBEIndex">
<Description>
Bitmap Extent Index auto-generated by DDL CREATE TABLE statement.  Do not edit the SqlName of this index.</Description>
<Type>bitmap</Type>
<Extent>1</Extent>
<Properties/>
<SqlName>%%DDLBEIndex</SqlName>
</Index>

<Index name="DatetimeJstIndex">
<Type>index</Type>
<Properties>DatetimeJst</Properties>
<SqlName>DatetimeJstIndex</SqlName>
</Index>

<Index name="SpotIDIdx">
<Type>index</Type>
<Properties>SpotID</Properties>
<SqlName>SpotIDIdx</SqlName>
</Index>

<Parameter name="USEEXTENTSET">
<Default>1</Default>
</Parameter>

<Storage name="Default">
<Type>%Storage.Persistent</Type>
<DataLocation>^CJ7T.wOJn.1</DataLocation>
<DefaultData>BayInfoDefaultData</DefaultData>
<IdLocation>^CJ7T.wOJn.1</IdLocation>
<IndexLocation>^CJ7T.wOJn.I</IndexLocation>
<StreamLocation>^CJ7T.wOJn.S</StreamLocation>
<ExtentSize>19576</ExtentSize>
<IdFunction>sequence</IdFunction>
<ExtentLocation>^CJ7T.wOJn</ExtentLocation>
<Data name="BayInfoDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>SpotID</Value>
</Value>
<Value name="2">
<Value>SpotName</Value>
</Value>
<Value name="3">
<Value>DatetimeJst</Value>
</Value>
<Value name="4">
<Value>TideHeightCmRelative</Value>
</Value>
<Value name="5">
<Value>TideState</Value>
</Value>
<Value name="6">
<Value>TideCycle</Value>
</Value>
</Data>
<Property name="%%ID">
<Selectivity>1</Selectivity>
<AverageFieldSize>3.99</AverageFieldSize>
<Histogram>$lb(.06666666666666666667,1,0,$lb(132,856,2015,3125,4305,5817,7089,8281,9221,10502,12436,13923,14832,15946,17312,19426),$lb(0,0,0,0,0,0,0,0,0,1,1,1,1,1,1),"")</Histogram>
</Property>
<Property name="DatetimeJst">
<Selectivity>0.0089%</Selectivity>
<OutlierSelectivity>.001044:1154676137406846976</OutlierSelectivity>
<AverageFieldSize>10</AverageFieldSize>
<Histogram>$lb(.06666666666666666667,1,0,$lb(1154675561406846976,1154678067006846976,1154680097406846976,1154683459806846976,1154685378606846976,1154688633006846976,1154690289006846976,1154692305006846976,1154694259806846976,1154696643006846976,1154699091006846976,1154701312206846976,1154703353406846976,1154705340606846976,1154708389806846976,1154710449006846976),$lb(6,5,6,6,6,5,6,6,6,6,4,6,6,6,5),"")</Histogram>
</Property>
<Property name="SpotID">
<Selectivity>50.0000%</Selectivity>
<AverageFieldSize>8</AverageFieldSize>
<Histogram>$lb(.06666666666666666667,0,0,$lb(" TB-001"," TB-001"," TB-001"," TB-001"," TB-001"," TB-001"," TB-001"," TB-001"," TB-001"," TB-004"," TB-004"," TB-004"," TB-004"," TB-004"," TB-004"," TB-004"),$lb(8,8,8,8,8,8,8,8,6,8,8,8,8,8,8),$lb(542392877,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,822083584,872415232,0,0,0,0,0,0,0,0,0,0,0,0,542392877))</Histogram>
</Property>
<Property name="SpotName">
<Selectivity>50.0000%</Selectivity>
<AverageFieldSize>16.55</AverageFieldSize>
<Histogram>$lb(.06666666666666666667,0,0,$lb(" 木更津沖堤防"," 木更津沖堤防"," 木更津沖堤防"," 木更津沖堤防"," 木更津沖堤防"," 木更津沖堤防"," 木更津沖堤防"," 木更津沖堤防"," 木更津沖堤防"," 横浜本牧海づり施設"," 横浜本牧海づり施設"," 横浜本牧海づり施設"," 横浜本牧海づり施設"," 横浜本牧海づり施設"," 横浜本牧海づり施設"," 横浜本牧海づり施設"),$lb(8,8,8,8,8,8,8,8,1,11,11,11,11,11,11),$lb(551984296,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3869026534,3869813478,0,0,0,0,0,0,0,0,0,0,0,0,551987370))</Histogram>
</Property>
<Property name="TideCycle">
<Selectivity>20.0000%</Selectivity>
<AverageFieldSize>6</AverageFieldSize>
<Histogram>$lb(.06666666666666666667,0,0,$lb(" 中潮"," 中潮"," 中潮"," 中潮"," 中潮"," 大潮"," 大潮"," 大潮"," 小潮"," 小潮"," 小潮"," 小潮"," 若潮"," 若潮"," 長潮"," 長潮"),$lb(4,4,4,4,1,4,4,1,4,4,4,1,4,1,4),$lb(551860397,0,0,0,0,0,0,0,0,3837308390,3852773350,0,0,0,0,3852773350,3853553638,0,0,0,0,0,0,3853553638,3901466086,0,0,3901466086,3918903270,0,0,552179127))</Histogram>
</Property>
<Property name="TideHeightCmRelative">
<Selectivity>0.0393%</Selectivity>
<OutlierSelectivity>.007829:-4</OutlierSelectivity>
<AverageFieldSize>4.69</AverageFieldSize>
<Histogram>$lb(.06666666666666666667,1,0,$lb(-13.9,-9.7,-4,14,18.8,32.6,62.8,79,106,132.4,148.7,167,181.5,200.8,220.7,253.8),$lb(1,1,0,1,0,0,0,0,1,1,1,1,0,1,1),"")</Histogram>
</Property>
<Property name="TideState">
<Selectivity>50.0000%</Selectivity>
<AverageFieldSize>8</AverageFieldSize>
<Histogram>$lb(.06666666666666666667,0,0,$lb(" 上げ潮"," 上げ潮"," 上げ潮"," 上げ潮"," 上げ潮"," 上げ潮"," 上げ潮"," 上げ潮"," 下げ潮"," 下げ潮"," 下げ潮"," 下げ潮"," 下げ潮"," 下げ潮"," 下げ潮"," 下げ潮"),$lb(5,5,5,5,5,5,5,1,5,5,5,5,5,5,5),$lb(551860362,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3837299427,3837299683,0,0,0,0,0,0,0,0,0,0,0,0,0,0,551860363))</Histogram>
</Property>
<SQLMap name="%%DDLBEIndex">
<BlockCount>-4</BlockCount>
</SQLMap>
<SQLMap name="DatetimeJstIndex">
<BlockCount>-176</BlockCount>
</SQLMap>
<SQLMap name="IDKEY">
<BlockCount>-640</BlockCount>
</SQLMap>
<SQLMap name="SpotIDIdx">
<BlockCount>-88</BlockCount>
</SQLMap>
<Index name="DDLBEIndex">
<Location>^CJ7T.wOJn.2</Location>
</Index>
<Index name="DatetimeJstIndex">
<Location>^CJ7T.wOJn.4</Location>
</Index>
<Index name="IDKEY">
<Location>^CJ7T.wOJn.1</Location>
</Index>
<Index name="SpotIDIdx">
<Location>^CJ7T.wOJn.3</Location>
</Index>
</Storage>
</Class>


<Class name="MeetUp2025.Event">
<Description>
CLIPのモデルロードとEmbeddingを行うユーティリティクラス
イベントクラスについての参考記事：https://jp.community.intersystems.com/node/584051
WSGI</Description>
<Super>%RegisteredObject</Super>
<TimeChanged>67501,34850.517503755</TimeChanged>
<TimeCreated>67501,34850.517503755</TimeCreated>

<Method name="createEvent">
<Description>
1秒ごと監視</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>timeout:%Integer=1</FormalSpec>
<Implementation><![CDATA[
    kill ^isj,^ZFishEvent,^IRISTempFish
    set ^ZFishEvent("STOP")=0
    
    //cliputil.pyインポート
    set sys=##class(%SYS.Python).Import("sys")
    do sys.path.append("/usr/irissys/mgr/user/0.Prep/src")
    set start=$ZH
    set cliputil=##class(%SYS.Python).Import("cliputil")
    set ^isj("IRIS-clip-load")=$ZH-start
    // ロード終了確認用
    write "CLIP-Load完了：",^isj("IRIS-clip-load"),!
    // イベント作成
    set status=$SYSTEM.Event.Create("FishEvent")
    set num=1
    // ^ZFishEvent("STOP")が0の時はループ、1になったら停止
    while ($GET(^ZFishEvent("STOP"))=0) {
        // timeout以内にSignalがあればEmbedding実行
        // 呼び出し側が　do $SYSTEM.Event.Signal("FishEvent",imgdir)　を送ってくるパタン
        set sigmsg=$SYSTEM.Event.WaitMsg("FishEvent",timeout)
        // IRISのリスト 1番目の値が1ならSignal送ってきている
        if $LIST(sigmsg,1)=0 {
            continue
        }
        // $LISTBUILD(メッセージ,番号) で情報が渡る
        set embedinfo=$LIST(sigmsg,2)
        set embedingtype=$LIST(embedinfo,1) //TまたはI
        set embedimg=$LIST(embedinfo,2) //Embeddingするテキスト、または画像ファイル名
        set fishnum=$LIST(embedinfo,3)  //この番号をキーにEmbedding結果をセットする
        set ^isj("IRIS-clip-embedding-data",num)=embedimg
        set start=$ZH
        //CLIPを使ったEmbedding実行
        if embedingtype="T" {
            set embed=cliputil."get_clip_text_embeddings"(embedimg)
        }
        else {
            set embed=cliputil."get_image_embeddings"(embedimg)
        }
        //Signal送り側が使用する情報を指定された番号をキーにセット
        set ^IRISTempFish(fishnum)=embed
        set ^isj("IRIS-clip-embedding",num)=$ZH-start
        set num=num+1
    }
    // 終了確認用グローバル
    set ^ZFishEvent="END"
]]></Implementation>
</Method>

<Method name="GetEmbedding">
<Description>
CLIPモデル 画像をEmbeddingを行うときに呼ぶメソッド（またはストアドプロシージャ）
引数1：Embeddingのタイプ：テキストならT、画像ならI
引数2：Embeddingを行う情報（第1引数がTならテキスト、Iなら画像のフルパス）</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>type:%String,in:%String</FormalSpec>
<ReturnType>%Vector</ReturnType>
<SqlName>GetEmbedding</SqlName>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[
    #dim %sqlcontext As %ProcedureContext
    if $get(type)="" {
        set %sqlcontext.%Message="エラー：typeが指定されていません"
        set %sqlcontext.%SQLCODE=-401
        return ""
    }
    // typeがTでもIでもないとき
    if '(($get(type)="T") || ($get(type)="I")) {
        set %sqlcontext.%Message="エラー：typeの指定が違います。type："_$get(type)
        set %sqlcontext.%SQLCODE=-401
        return ""
    } 
    // Embedding結果を受け取る時に使用する通し番号セット
    set fishnum=$INCREMENT(^IRISTempFish)
    // SignalのメッセージとしてIRISのリストで1、テキストか画像かのフラグ（T/I）、テキストなら文字列/画像ならファイルフルパス,番号 を送付
    set status=$SYSTEM.Event.Signal("FishEvent",$LISTBUILD(type,in,fishnum))
    // 失敗時
    if status=0 {
        set %sqlcontext.%Message="エラー："_in
        set %sqlcontext.%SQLCODE=-401
        return ""
    }
    //^IRISTempFish(fishnum)の中にEmbedding結果ができるので存在するまで待機
    while $get(^IRISTempFish(fishnum))="" {
        hang 0.1
    }
    set embedval=^IRISTempFish(fishnum)
    kill ^IRISTempFish(fishnum)
    return embedval
]]></Implementation>
</Method>

<Method name="EndEvent">
<Description>
常駐プロセス終了用メソッド（イベント終了に使用するグローバルをセット）</Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[    set ^ZFishEvent("STOP")=1
]]></Implementation>
</Method>
</Class>


<Class name="MeetUp2025.Fish">
<Description>
</Description>
<Final>1</Final>
<ClassType>persistent</ClassType>
<DdlAllowed>1</DdlAllowed>
<Owner>SuperUser</Owner>
<ProcedureBlock>1</ProcedureBlock>
<SqlRowIdPrivate>1</SqlRowIdPrivate>
<SqlTableName>Fish</SqlTableName>
<Super>%Persistent</Super>
<TimeChanged>67499,85361.616728943</TimeChanged>
<TimeCreated>67499,85272.495111722</TimeCreated>

<Property name="FishID">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>2</SqlColumnNumber>
<Parameter name="MAXLEN" value="10"/>
</Property>

<Property name="Name">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>3</SqlColumnNumber>
<Parameter name="MAXLEN" value="50"/>
</Property>

<Property name="Features">
<Type>%Library.Vector</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>4</SqlColumnNumber>
<Parameter name="DATATYPE" value="DOUBLE"/>
<Parameter name="LEN" value="512"/>
</Property>

<Index name="DDLBEIndex">
<Description>
Bitmap Extent Index auto-generated by DDL CREATE TABLE statement.  Do not edit the SqlName of this index.</Description>
<Type>bitmap</Type>
<Extent>1</Extent>
<Properties/>
<SqlName>%%DDLBEIndex</SqlName>
</Index>

<Index name="HNSWIndex">
<Type>index</Type>
<Properties>Features</Properties>
<SqlName>HNSWIndex</SqlName>
<TypeClass>%SQL.Index.HNSW</TypeClass>
<Parameter name="Distance" value="Cosine"/>
</Index>

<Parameter name="USEEXTENTSET">
<Default>1</Default>
</Parameter>

<Storage name="Default">
<Type>%Storage.Persistent</Type>
<DataLocation>^CJ7T.CuqN.1</DataLocation>
<DefaultData>FishDefaultData</DefaultData>
<IdLocation>^CJ7T.CuqN.1</IdLocation>
<IndexLocation>^CJ7T.CuqN.I</IndexLocation>
<StreamLocation>^CJ7T.CuqN.S</StreamLocation>
<ExtentSize>93</ExtentSize>
<IdFunction>sequence</IdFunction>
<ExtentLocation>^CJ7T.CuqN</ExtentLocation>
<Data name="FishDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>FishID</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
</Data>
<Data name="_GBL_Features">
<Attribute>Features</Attribute>
<Structure>node</Structure>
<DataDefinitionLocation>^CJ7T.CuqN.1.P1</DataDefinitionLocation>
<Value name="1">
<Value>Features</Value>
</Value>
</Data>
<Property name="%%ID">
<Selectivity>1</Selectivity>
<AverageFieldSize>3</AverageFieldSize>
<Histogram>$lb(.06666666666666666667,1,0,$lb(1,7,14,21,27,33,39,45,51,57,63,69,75,81,87,93),$lb(0,0,0,1,0,1,0,0,1,0,1,0,0,1,0),"")</Histogram>
</Property>
<Property name="Features">
<Selectivity>1</Selectivity>
<AverageFieldSize>8516</AverageFieldSize>
</Property>
<Property name="FishID">
<Selectivity>1.0753%</Selectivity>
<AverageFieldSize>6</AverageFieldSize>
<Histogram>$lb(.06666666666666666667,0,0,$lb(" F001"," F007"," F014"," F021"," F027"," F033"," F039"," F045"," F051"," F057"," F063"," F069"," F075"," F081"," F087"," F094"),$lb(4,3,3,4,3,4,3,3,4,3,4,3,3,4,3),$lb(541470768,822083584,922746880,808910848,825491456,825491456,842072064,822083584,922746880,842465280,858980352,855638016,956301312,859373568,875888640,875888640,892403712,822083584,922746880,892796928,909312000,855638016,956301312,909705216,926220288,926220288,942735360,822083584,922746880,943128576,959709184,541470777))</Histogram>
</Property>
<Property name="Name">
<Selectivity>1.0753%</Selectivity>
<AverageFieldSize>9.87</AverageFieldSize>
<Histogram>$lb(.06666666666666666667,0,0,$lb(" アイナメ"," アマエビ"," ウツボ"," カマス"," ギンダラ"," クロマグロ"," サケ"," シロギス"," ゼブラフィッシュ"," トラフグ"," ハナダイ"," フナ"," ボタンエビ"," マハタ"," モロコ"," 鯛"),$lb(2,1,1,1,1,1,1,1,1,1,1,1,1,1,1),$lb(551781026,3816989923,3817053923,3816989411,3816990435,3816990435,3816991715,3816991715,3816992483,3816992483,3816992739,3816992739,3816994275,3816994275,3816994787,3816994787,3816996067,3816996067,3817048291,3817048291,3817050083,3817050083,3817051619,3817051619,3817053411,3817053411,3817053923,3817053923,3817054947,3817054947,3920599808,552185755))</Histogram>
</Property>
<SQLMap name="%%DDLBEIndex">
<BlockCount>-4</BlockCount>
</SQLMap>
<SQLMap name="HNSWIndex">
<BlockCount>-12</BlockCount>
</SQLMap>
<SQLMap name="IDKEY">
<BlockCount>-4</BlockCount>
</SQLMap>
<Index name="DDLBEIndex">
<Location>^CJ7T.CuqN.2</Location>
</Index>
<Index name="HNSWIndex">
<Location>^CJ7T.CuqN.3</Location>
</Index>
<Index name="IDKEY">
<Location>^CJ7T.CuqN.1</Location>
</Index>
</Storage>
</Class>


<Class name="MeetUp2025.FishImage">
<Description>
</Description>
<Final>1</Final>
<ClassType>persistent</ClassType>
<DdlAllowed>1</DdlAllowed>
<Owner>SuperUser</Owner>
<ProcedureBlock>1</ProcedureBlock>
<SqlRowIdPrivate>1</SqlRowIdPrivate>
<SqlTableName>FishImage</SqlTableName>
<Super>%Persistent</Super>
<TimeChanged>67499,85368.918057777</TimeChanged>
<TimeCreated>67499,85272.724163557</TimeCreated>

<Property name="Name">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>2</SqlColumnNumber>
<Parameter name="MAXLEN" value="100"/>
</Property>

<Property name="Features">
<Type>%Library.Vector</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>3</SqlColumnNumber>
<Parameter name="DATATYPE" value="DOUBLE"/>
<Parameter name="LEN" value="512"/>
</Property>

<Index name="DDLBEIndex">
<Description>
Bitmap Extent Index auto-generated by DDL CREATE TABLE statement.  Do not edit the SqlName of this index.</Description>
<Type>bitmap</Type>
<Extent>1</Extent>
<Properties/>
<SqlName>%%DDLBEIndex</SqlName>
</Index>

<Index name="HNSWIndex">
<Type>index</Type>
<Properties>Features</Properties>
<SqlName>HNSWIndex</SqlName>
<TypeClass>%SQL.Index.HNSW</TypeClass>
<Parameter name="Distance" value="Cosine"/>
</Index>

<Parameter name="USEEXTENTSET">
<Default>1</Default>
</Parameter>

<Storage name="Default">
<Type>%Storage.Persistent</Type>
<DataLocation>^CJ7T.CLAo.1</DataLocation>
<DefaultData>FishImageDefaultData</DefaultData>
<IdLocation>^CJ7T.CLAo.1</IdLocation>
<IndexLocation>^CJ7T.CLAo.I</IndexLocation>
<StreamLocation>^CJ7T.CLAo.S</StreamLocation>
<ExtentSize>24</ExtentSize>
<IdFunction>sequence</IdFunction>
<ExtentLocation>^CJ7T.CLAo</ExtentLocation>
<Data name="FishImageDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>Name</Value>
</Value>
</Data>
<Data name="_GBL_Features">
<Attribute>Features</Attribute>
<Structure>node</Structure>
<DataDefinitionLocation>^CJ7T.CLAo.1.P1</DataDefinitionLocation>
<Value name="1">
<Value>Features</Value>
</Value>
</Data>
<Property name="%%ID">
<Selectivity>1</Selectivity>
<AverageFieldSize>3</AverageFieldSize>
<Histogram>$lb(.06666666666666666667,1,0,$lb(1,2,4,6,8,10,12,14,16,18,19,20,21,22,23,24),$lb(0,0,0,0,0,1,1,1,1,1,0,1,1,1,1),"")</Histogram>
</Property>
<Property name="Features">
<Selectivity>1</Selectivity>
<AverageFieldSize>8516</AverageFieldSize>
</Property>
<Property name="Name">
<Selectivity>4.1667%</Selectivity>
<AverageFieldSize>19.58</AverageFieldSize>
<Histogram>$lb(.06666666666666666667,0,0,$lb(" アオリイカ.JPG"," イシガキダイ.JPG"," カツオ.JPG"," ギンブナ.JPG"," クルマエビ.JPEG"," コイ.JPG"," シーバス.JPG"," タチウオ.JPG"," ヒラメ.JPEG"," ボタンエビ.JPG"," マアジ.JPG"," マイワシ.JPG"," マサバ.JPEG"," マダコ.JPG"," マハタ.JPG"," ミズダコ.JPG"),$lb(1,1,1,1,1,1,1,1,1,1,2,2,2,2,1),$lb(551781026,3816989411,3816989923,3816989923,3816991715,3816991715,3816992227,3816992227,3816992739,3816992739,3816993763,3816993763,3816994787,3816994787,3816996835,3816996835,3817050851,3817050851,3817053155,3817053155,3817053923,3816989411,3816989923,3816989923,3816994275,3816994275,3816996835,3816996835,3817050083,3817053923,3817054179,551781279))</Histogram>
</Property>
<SQLMap name="%%DDLBEIndex">
<BlockCount>-4</BlockCount>
</SQLMap>
<SQLMap name="HNSWIndex">
<BlockCount>-4</BlockCount>
</SQLMap>
<SQLMap name="IDKEY">
<BlockCount>-4</BlockCount>
</SQLMap>
<Index name="DDLBEIndex">
<Location>^CJ7T.CLAo.2</Location>
</Index>
<Index name="HNSWIndex">
<Location>^CJ7T.CLAo.3</Location>
</Index>
<Index name="IDKEY">
<Location>^CJ7T.CLAo.1</Location>
</Index>
</Storage>
</Class>


<Class name="MeetUp2025.FishingInfo">
<Description>
</Description>
<Final>1</Final>
<ClassType>persistent</ClassType>
<DdlAllowed>1</DdlAllowed>
<Owner>SuperUser</Owner>
<ProcedureBlock>1</ProcedureBlock>
<SqlRowIdPrivate>1</SqlRowIdPrivate>
<SqlTableName>FishingInfo</SqlTableName>
<Super>%Persistent</Super>
<TimeChanged>67499,85321.425370055</TimeChanged>
<TimeCreated>67499,85276.692905773</TimeCreated>

<Property name="SpotID">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>2</SqlColumnNumber>
<Parameter name="MAXLEN" value="50"/>
</Property>

<Property name="FishID">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>3</SqlColumnNumber>
<Parameter name="MAXLEN" value="50"/>
</Property>

<Property name="ReportDate">
<Type>%Library.Date</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>4</SqlColumnNumber>
</Property>

<Property name="Size">
<Type>%Library.Numeric</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>5</SqlColumnNumber>
<Parameter name="MAXVAL" value="999999999999999"/>
<Parameter name="MINVAL" value="-999999999999999"/>
<Parameter name="SCALE" value="0"/>
</Property>

<Property name="FishCount">
<Type>%Library.Numeric</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>6</SqlColumnNumber>
<Parameter name="MAXVAL" value="999999999999999"/>
<Parameter name="MINVAL" value="-999999999999999"/>
<Parameter name="SCALE" value="0"/>
</Property>

<Index name="DDLBEIndex">
<Description>
Bitmap Extent Index auto-generated by DDL CREATE TABLE statement.  Do not edit the SqlName of this index.</Description>
<Type>bitmap</Type>
<Extent>1</Extent>
<Properties/>
<SqlName>%%DDLBEIndex</SqlName>
</Index>

<Index name="FishIDIdx">
<Type>index</Type>
<Properties>FishID</Properties>
<SqlName>FishIDIdx</SqlName>
</Index>

<Index name="ReportDateIdx">
<Type>index</Type>
<Properties>ReportDate</Properties>
<SqlName>ReportDateIdx</SqlName>
</Index>

<Index name="SpotIDIdx">
<Type>index</Type>
<Properties>SpotID</Properties>
<SqlName>SpotIDIdx</SqlName>
</Index>

<Parameter name="USEEXTENTSET">
<Default>1</Default>
</Parameter>

<Storage name="Default">
<Type>%Storage.Persistent</Type>
<DataLocation>^CJ7T.EgBx.1</DataLocation>
<DefaultData>FishingInfoDefaultData</DefaultData>
<IdLocation>^CJ7T.EgBx.1</IdLocation>
<IndexLocation>^CJ7T.EgBx.I</IndexLocation>
<StreamLocation>^CJ7T.EgBx.S</StreamLocation>
<ExtentSize>2504</ExtentSize>
<IdFunction>sequence</IdFunction>
<ExtentLocation>^CJ7T.EgBx</ExtentLocation>
<Data name="FishingInfoDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>SpotID</Value>
</Value>
<Value name="2">
<Value>FishID</Value>
</Value>
<Value name="3">
<Value>ReportDate</Value>
</Value>
<Value name="4">
<Value>Size</Value>
</Value>
<Value name="5">
<Value>FishCount</Value>
</Value>
</Data>
<Property name="%%ID">
<Selectivity>1</Selectivity>
<AverageFieldSize>3.9</AverageFieldSize>
<Histogram>$lb(.06666666666666666667,1,0,$lb(1,167,334,501,668,835,1002,1169,1336,2200,2367,2534,2701,2868,3035,3201),$lb(1,0,0,0,0,0,1,1,0,1,1,1,1,0,1),"")</Histogram>
</Property>
<Property name="FishCount">
<Selectivity>0.5998%</Selectivity>
<OutlierSelectivity>.664137:1</OutlierSelectivity>
<AverageFieldSize>3</AverageFieldSize>
<Histogram>$lb(.06666666666666666667,1,0,$lb(1,1,1,1,1,1,1,1,1,1,2,3,5,10,20,153),$lb(1,1,1,1,1,1,1,1,1,0,0,0,0,0,0),"")</Histogram>
</Property>
<Property name="FishID">
<Selectivity>2.2364%</Selectivity>
<OutlierSelectivity>.194888:"f025"</OutlierSelectivity>
<AverageFieldSize>6</AverageFieldSize>
<Histogram>$lb(.06666666666666666667,0,0,$lb(" F001"," F001"," F001"," F007"," F010"," F010"," F019"," F020"," F021"," F025"," F025"," F025"," F027"," F027"," F034"," F040"),$lb(6,6,4,3,6,4,3,4,4,6,6,4,6,3,3),$lb(541470768,0,0,0,0,822083584,922746880,808910848,825229312,0,0,805306368,956301312,825819136,842006528,805306368,822083584,822083584,889192448,0,0,0,0,889192448,922746880,0,0,842465280,859045888,859045888,875560960,541470772))</Histogram>
</Property>
<Property name="ReportDate">
<Selectivity>0.1982%</Selectivity>
<OutlierSelectivity>.01278:67127</OutlierSelectivity>
<AverageFieldSize>5</AverageFieldSize>
<Histogram>$lb(.06666666666666666667,1,0,$lb(66476,66633,66692,66749,66781,66807,66963,67042,67085,67125,67144,67167,67197,67368,67459,67568),$lb(2,3,2,3,2,2,1,3,2,3,3,3,2,2,2),"")</Histogram>
</Property>
<Property name="Size">
<Selectivity>0.6471%</Selectivity>
<OutlierSelectivity>.301118:</OutlierSelectivity>
<AverageFieldSize>2.7</AverageFieldSize>
<Histogram>$lb(.06666666666666666667,1,5,$lb(-10000000000000000000,-10000000000000000000,-10000000000000000000,-10000000000000000000,-10000000000000000000,15,19,20,23,27,40,50,60,70,84,166),$lb(21,21,21,21,0,1,0,1,1,0,0,0,0,0,0),"")</Histogram>
</Property>
<Property name="SpotID">
<Selectivity>50.0000%</Selectivity>
<AverageFieldSize>8</AverageFieldSize>
<Histogram>$lb(.06666666666666666667,0,0,$lb(" TB-001"," TB-001"," TB-001"," TB-001"," TB-001"," TB-001"," TB-001"," TB-001"," TB-001"," TB-004"," TB-004"," TB-004"," TB-004"," TB-004"," TB-004"," TB-004"),$lb(8,8,8,8,8,8,8,8,6,8,8,8,8,8,8),$lb(542392877,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,822083584,872415232,0,0,0,0,0,0,0,0,0,0,0,0,542392877))</Histogram>
</Property>
<SQLMap name="%%DDLBEIndex">
<BlockCount>-4</BlockCount>
</SQLMap>
<SQLMap name="FishIDIdx">
<BlockCount>-16</BlockCount>
</SQLMap>
<SQLMap name="IDKEY">
<BlockCount>-44</BlockCount>
</SQLMap>
<SQLMap name="ReportDateIdx">
<BlockCount>-16</BlockCount>
</SQLMap>
<SQLMap name="SpotIDIdx">
<BlockCount>-12</BlockCount>
</SQLMap>
<Index name="DDLBEIndex">
<Location>^CJ7T.EgBx.2</Location>
</Index>
<Index name="FishIDIdx">
<Location>^CJ7T.EgBx.4</Location>
</Index>
<Index name="IDKEY">
<Location>^CJ7T.EgBx.1</Location>
</Index>
<Index name="ReportDateIdx">
<Location>^CJ7T.EgBx.5</Location>
</Index>
<Index name="SpotIDIdx">
<Location>^CJ7T.EgBx.3</Location>
</Index>
</Storage>
</Class>


<Class name="MeetUp2025.InstallUtils">
<TimeChanged>67501,34850.517366054</TimeChanged>
<TimeCreated>67501,34850.517366054</TimeCreated>

<Method name="loadsql">
<Description>
*.sqlにあるSQL文を LOAD SQLコマンドで実行する</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>file:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    //ログは入力ファイルと同じディレクトリに置く
    set logfile=##class(%File).GetDirectory(file)_"sqlload-log.txt"
    set sql="LOAD SQL FROM FILE '"_file_"' DIALECT 'IRIS'"
    set sql=sql_" LOG TO FILE '"_logfile_"' IGNORE ERRORS"
    set stmt=##class(%SQL.Statement).%New()
    set tResult = ##class(%SQL.Statement).%ExecDirect(.tStatement,sql)
    if tResult.%SQLCODE<0 {
        write "Error::",tResult.%Message,!
    }
]]></Implementation>
</Method>

<Method name="loaddata">
<Description>
*.jsonlロード用メソッド
file : .jsonlのフルパスを指定
table: INSERT対象テーブル名を指定</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>file:%String,table:%String</FormalSpec>
<Language>python</Language>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[
    import iris
    import irisbuiltins
    import time
    import json
    start = time.time()  # 現在時刻（処理開始前）を取得
    try:
        with open(file, "r", encoding="utf-8") as f:
            embeddingdata = [json.loads(line) for line in f]
        
        if table=="MeetUp2025.SampleImage":
            sql="insert into MeetUp2025.SampleImage (ImgID,ImgEmbedding) Values(?,TO_VECTOR(?,FLOAT,512))"
            stmt=iris.sql.prepare(sql)
            for item in embeddingdata:
                embeddingstr=str(item["imgembedding"])
                rs=stmt.execute(item["imgid"],embeddingstr[1:-1])
    
        elif table=="MeetUp2025.Fish":
            sql="insert into MeetUp2025.Fish (FishID,Name,Features) Values(?,?,TO_VECTOR(?,DOUBLE,512))"
            stmt=iris.sql.prepare(sql)
            for item in embeddingdata:
                rs=stmt.execute(item["fishid"],item["name"],item["features"])

        elif table=="MeetUp2025.FishImage":
            sql="insert into MeetUp2025.FishImage (Name,Features) Values(?,TO_VECTOR(?,DOUBLE,512))"
            stmt=iris.sql.prepare(sql)
            for item in embeddingdata:
                rs=stmt.execute(item["filename"],item["features"])

    except irisbuiltins.SQLError as ex:
        print(str(repr(ex)))
        print(ex.sqlcode)
        print(ex.message)
        print(ex.statement)
        raise
    
    end = time.time()  # 現在時刻（処理完了後）を取得
    time_diff = end - start  # 処理完了後の時刻から処理開始前の時刻を減算する
    print(f"処理時間：{time_diff}")  # 処理にかかった時間データを使用
]]></Implementation>
</Method>

<Method name="loadfish">
<Description>
MeetUp2025.Fish用データ取り込み</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>file:%String</FormalSpec>
<Language>python</Language>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[
    import iris
    import irisbuiltins
    import json
    import time
    start = time.time()  # 現在時刻（処理開始前）を取得
    try:
        with open(file, "r", encoding="utf-8") as f:
            fish_docs = [json.loads(line) for line in f]
        
        sql="insert into MeetUp2025.Fish (FishID,FishName,FishNameVec) Values(?,?,TO_VECTOR(?,DOUBLE,512))"
        stmt=iris.sql.prepare(sql)
        for item in fish_docs:
            #print(type(item["embedding"][0]))
            embeddingstr=str(item["embedding"])
            print(embeddingstr[1:-1])
            rs=stmt.execute(item["fishid"],item["fishname"],embeddingstr[1:-1])            
            #rs=stmt.execute(item["fishname"],item["text"],item["embedding"][0])
    
    except irisbuiltins.SQLError as ex:
        print(str(repr(ex)))
        print(ex.sqlcode)
        print(ex.message)
        print(ex.statement)
        raise
    
    end = time.time()  # 現在時刻（処理完了後）を取得
    time_diff = end - start  # 処理完了後の時刻から処理開始前の時刻を減算する
    print(f"処理時間：{time_diff}")  # 処理にかかった時間データを使用
]]></Implementation>
</Method>
</Class>


<Class name="MeetUp2025.SampleImage">
<Description>
</Description>
<Final>1</Final>
<ClassType>persistent</ClassType>
<DdlAllowed>1</DdlAllowed>
<Owner>SuperUser</Owner>
<ProcedureBlock>1</ProcedureBlock>
<SqlRowIdPrivate>1</SqlRowIdPrivate>
<SqlTableName>SampleImage</SqlTableName>
<Super>%Persistent</Super>
<TimeChanged>67499,85373.045252334</TimeChanged>
<TimeCreated>67499,85272.225913838</TimeCreated>

<Property name="ImgId">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>2</SqlColumnNumber>
<Parameter name="MAXLEN" value="100"/>
</Property>

<Property name="ImgEmbedding">
<Type>%Library.Vector</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>3</SqlColumnNumber>
<Parameter name="DATATYPE" value="FLOAT"/>
<Parameter name="LEN" value="512"/>
</Property>

<Index name="DDLBEIndex">
<Description>
Bitmap Extent Index auto-generated by DDL CREATE TABLE statement.  Do not edit the SqlName of this index.</Description>
<Type>bitmap</Type>
<Extent>1</Extent>
<Properties/>
<SqlName>%%DDLBEIndex</SqlName>
</Index>

<Index name="HNSWIndex">
<Type>index</Type>
<Properties>ImgEmbedding</Properties>
<SqlName>HNSWIndex</SqlName>
<TypeClass>%SQL.Index.HNSW</TypeClass>
<Parameter name="Distance" value="Cosine"/>
</Index>

<Parameter name="USEEXTENTSET">
<Default>1</Default>
</Parameter>

<Storage name="Default">
<Type>%Storage.Persistent</Type>
<DataLocation>^CJ7T.Bov2.1</DataLocation>
<DefaultData>SampleImageDefaultData</DefaultData>
<IdLocation>^CJ7T.Bov2.1</IdLocation>
<IndexLocation>^CJ7T.Bov2.I</IndexLocation>
<StreamLocation>^CJ7T.Bov2.S</StreamLocation>
<ExtentSize>843</ExtentSize>
<IdFunction>sequence</IdFunction>
<ExtentLocation>^CJ7T.Bov2</ExtentLocation>
<Data name="SampleImageDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>ImgId</Value>
</Value>
</Data>
<Data name="_GBL_ImgEmbedding">
<Attribute>ImgEmbedding</Attribute>
<Structure>node</Structure>
<DataDefinitionLocation>^CJ7T.Bov2.1.P1</DataDefinitionLocation>
<Value name="1">
<Value>ImgEmbedding</Value>
</Value>
</Data>
<Property name="%%ID">
<Selectivity>1</Selectivity>
<AverageFieldSize>3.7</AverageFieldSize>
<Histogram>$lb(.06666666666666666667,1,0,$lb(1,57,114,171,227,283,339,395,451,507,563,619,675,731,787,843),$lb(0,0,1,0,1,0,1,0,0,1,0,1,0,1,0),"")</Histogram>
</Property>
<Property name="ImgEmbedding">
<Selectivity>1</Selectivity>
<AverageFieldSize>4420</AverageFieldSize>
</Property>
<Property name="ImgId">
<Selectivity>0.1186%</Selectivity>
<AverageFieldSize>29.32</AverageFieldSize>
<Histogram>$lb(.06666666666666666667,0,0,$lb(" 1034710665_39C3331C47_O.JPG"," 14977737321_A283B0263B_O.JPG"," 17153599479_71939D3502_O.JPG"," 2364353090_EB9AFD4420_O.JPG"," 2859057021_B8FC9E6231_O.JPG"," 3158908221_34AF33EC6A_O.JPG"," 3735739920_511A3DCC7A_O.JPG"," 4185143676_D1988BE8D8_O.JPG"," 4375610421_DFE72B0441_O.JPG"," 4700677710_FC86549F9D_O.JPG"," 50848097556_9BF1D4D548_O.JPG"," 5390041463_5FBF3266B1_O.JPG"," 5502709046_B92712BBF5_O.JPG"," 6664206343_842B4CE433_O.JPG"," 8442089152_F4135D1E1B_O.JPG"," 9979528903_640C167303_O.JPG"),$lb(2,2,1,2,1,2,1,2,2,1,2,2,1,1,1),$lb(540094515,808662071,876164919,876164919,925971763,825700661,842217012,859190323,943012144,842544441,858862904,825571385,926102839,859255605,875640885,825767217,859256118,859256118,925904950,876032048,892352564,808989752,859385904,859385904,892351031,892678194,909522484,909522484,942945330,942945330,960051001,540621111))</Histogram>
</Property>
<SQLMap name="%%DDLBEIndex">
<BlockCount>-4</BlockCount>
</SQLMap>
<SQLMap name="HNSWIndex">
<BlockCount>-108</BlockCount>
</SQLMap>
<SQLMap name="IDKEY">
<BlockCount>-20</BlockCount>
</SQLMap>
<Index name="DDLBEIndex">
<Location>^CJ7T.Bov2.2</Location>
</Index>
<Index name="HNSWIndex">
<Location>^CJ7T.Bov2.3</Location>
</Index>
<Index name="IDKEY">
<Location>^CJ7T.Bov2.1</Location>
</Index>
</Storage>
</Class>
</Export>
